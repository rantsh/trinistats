{% extends "covid19/base.html" %}
{% load static %}

    {% block rightsidebarform %}
       <form action="{% url 'covid19:totals' %}" method="get">
        <div>
        <hr style="border: 1px solid red;width:100%;"></hr>
        <label for="startdate" class=" w3-label1">Start Date</label>
        <input type="date" value="{{ enteredstartdate }}" id="startdate" name="startdate" class=" w3-date-selector">
        <label for="enddate" class=" w3-label1">End Date</label>
        <input type="date" value="{{ enteredenddate }}" id="enddate" name="enddate" class=" w3-date-selector "/>
        <label for="selectedcasetypeleft" class=" w3-label1">Left Axis</label>
        <select id="selectedcasetypeleft" name="selectedcasetypeleft" class=" w3-select1">
            {% for casetype in validcasetypes %}
                    {% if casetype.attname == selectedcasetypeleftstr %}
                        <option value="{{ casetype.attname }}" selected>{{casetype.verbose_name}}</option>
                    {% else %}
                        <option value="{{ casetype.attname }}">{{casetype.verbose_name}}</option>
                    {% endif %}
                {% endfor %}
        </select>
        <label for="selectedcasetyperight" class=" w3-label1">Right Axis</label>
        <select id="selectedcasetyperight" name="selectedcasetyperight" class=" w3-select1">
            {% for casetype in validcasetypes %}
                    {% if casetype.attname == selectedcasetyperightstr %}
                        <option value="{{ casetype.attname }}" selected>{{casetype.verbose_name}}</option>
                    {% else %}
                        <option value="{{ casetype.attname }}">{{casetype.verbose_name}}</option>
                    {% endif %}
                {% endfor %}
        </select>
        <hr style="border: 1px solid red;width:100%;"></hr>
    <button style="" class="w3-button3" type="submit">
    Run Query <i class="fa fa-database"></i></button>
    </div>
    </form>
    {% endblock rightsidebarform %}

    {% block maincontentdiv %}
    <br>
    <div class="w3-cell-row">
    <div class="w3-container w3-blue w3-cell w3-mobile w3-center">
        <p>{{ latestrecord.numtested }} samples submitted for testing &ensp;
        <i class="fas fa-microscope fa-2x"></i></p>
    </div>
    <div class="w3-container w3-orange w3-cell w3-mobile w3-center">
        <p>{{ latestrecord.numpositive }} persons tested positive &ensp; 
        <i class="fas fa-procedures fa-2x"></i></p>
    </div>
    <div class="w3-container w3-green w3-cell w3-mobile w3-center">
        <p>{{ latestrecord.numrecovered }} person(s) discharged &ensp; 
    <i class="fas fa-virus-slash fa-2x"></i></p>
    </div>
    <div class="w3-container w3-red w3-cell w3-mobile w3-center">
        <p>{{ latestrecord.numdeaths }} person(s) died &ensp; 
    <i class=" far fa-heart fa-2x"></i></p>
    </div>
    </div>
     {% block pagetitle %}
    <h3 style="margin-top:1em;text-align:center" id="pagetitle">T&T Covid-19 Cumulative Data</h3>
    {% endblock pagetitle %}
    <!-- Chart -->
    <div id="chartdiv" class="chartdiv">
    <canvas id="covid19chart">
        Covid19 Chart
    </canvas>
    </div>
    {% endblock maincontentdiv %}

    <!-- END MAIN -->
    
    <!--Javascript-->
    
    {% block chartjs %}
    {{ graphlabels|json_script:"graphlabels" }}
    {{ graphdataset|json_script:"graphdataset" }}
    <script>
    var ctx = document.getElementById('covid19chart').getContext("2d");
    //load in our graph date labels from the python context
    var graphlabels = JSON.parse(document.getElementById('graphlabels').textContent);
    //convert the datetime into moments for Javascript
    var i;
    for (i=0;i<graphlabels.length;i++){
        graphlabels[i] = new Date(graphlabels[i])
    }
    //load the actual dataset values 
    var graphdataset = JSON.parse(document.getElementById('graphdataset').textContent);
    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: graphlabels,
            datasets: graphdataset
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            scales: {
                xAxes: [{
                scaleLabel: {
                    display: true,
                    labelString: 'Date'},
                type: 'time',
                distribution: 'linear'
					}],
                yAxes: [{
                    id:'A',
                    scaleLabel: {
                        display: true,
                        labelString: '{{ selectedcasetypeleftverbose|escapejs }}'},
                    type:'linear',
                    position:'left',
                },
                {
                    id:'B',
                    scaleLabel: {
                        display: true,
                        labelString: '{{ selectedcasetyperightverbose|escapejs }}'},
                    type:'linear',
                    position:'right',
                },
                ]            
        }
        }
    });
    </script>
    {% endblock chartjs %}

    {% block morejs %}
    <script>
     //set the selected button colors
    var navtopbardiv = $("#navbartopdiv");
    var a_links = navtopbardiv.find("a");
    for (i = 0; i < a_links.length; i++) {
        if (a_links[i].id != "maincontentbutton")
            a_links[i].classList.remove("w3-theme-l2");
    }
    var leftsidebarstyling = $( "#leftsidebar" );
    var a_links = leftsidebarstyling.find("a");
    for (i = 0; i < a_links.length; i++) {
        if (a_links[i].id != "cumulativebutton")
            a_links[i].classList.remove("w3-theme-l2");
    } 
    </script>
    {% endblock%}